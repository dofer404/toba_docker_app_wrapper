#!/usr/bin/env bash

DIRBIN=`dirname $0`
DIRPROY=$DIRBIN/..
DIRAPP=$DIRPROY/app
DIRBD=$DIRPROY/bd

#app
DOCKERCOMPOSEFILE_NAME=docker-compose.yml
DOCKERCOMPOSEFILE=$DIRAPP/$DOCKERCOMPOSEFILE_NAME
COMPOSERFILE_NAME=composer.json
COMPOSERFILE=$DIRAPP/$COMPOSERFILE_NAME
CREARBDFILE_NAME=bd_app_crear.sql
ARCHIVO_TOBA_BASES_INI_BACKUP="$DIRBIN/aux/bases_BAK.ini"
ARCHIVO_TOBA_BASES_INI_APP="$DIRAPP/instalacion/bases.ini"
ARCHIVO_TOBA_BASES_INI_READY="$DIRBIN/aux/bases.ini"
#bd
CREARBDFILE=$DIRBD/$CREARBDFILE_NAME
CREARBDTOBAFILE_SQL_NAME=bd_toba_crear.sql
CREARBDTOBAFILE_SQL=$DIRBD/$CREARBDTOBAFILE_SQL_NAME
CREARBKBDSFILE_SH_NAME=bds_backup_crear.sh
CREARBKBDSFILE_SH=$DIRBD/$CREARBKBDSFILE_SH_NAME
RESTAURARBKBDSFILE_SH_NAME=bds_backup_restaurar.sh
RESTAURARBKBDSFILE_SH=$DIRBD/$RESTAURARBKBDSFILE_SH_NAME

#app
cp $DIRBIN/aux/$DOCKERCOMPOSEFILE_NAME $DOCKERCOMPOSEFILE
cp $DIRBIN/aux/$COMPOSERFILE_NAME $COMPOSERFILE
#bd
cp $DIRBIN/aux/$CREARBDTOBAFILE_SQL_NAME $CREARBDTOBAFILE_SQL
cp $DIRBIN/aux/$CREARBKBDSFILE_SH_NAME $CREARBKBDSFILE_SH
cp $DIRBIN/aux/$RESTAURARBKBDSFILE_SH_NAME $RESTAURARBKBDSFILE_SH
cp $DIRBIN/aux/$CREARBDFILE_NAME $CREARBDFILE

if [ -f $ARCHIVO_TOBA_BASES_INI_BACKUP ];
then
  cp $ARCHIVO_TOBA_BASES_INI_BACKUP $ARCHIVO_TOBA_BASES_INI_APP
  rm $ARCHIVO_TOBA_BASES_INI_BACKUP
else
  if [ -f $ARCHIVO_TOBA_BASES_INI_READY ];
  then
    rm $ARCHIVO_TOBA_BASES_INI_READY
    if [ -f $ARCHIVO_TOBA_BASES_INI_APP ];
    then
      rm $ARCHIVO_TOBA_BASES_INI_APP
    fi
  fi
fi
